apiVersion: apps/v1
kind: Deployment
metadata:
  name: cloud-services-deployment
  labels:
    app: licensing-suite
spec:
  replicas: 2
  selector:
    matchLabels:
      app: licensing-suite
  template:
    metadata:
      labels:
        app: licensing-suite
    spec:
      containers:
        # 1. Entitlements Service
        - name: entitlements-service
          image: entitlements-api:v1.2.0
          ports:
            - containerPort: 8080
          env:
            - name: SERVICE_NAME
              value: "entitlements"
          livenessProbe:
            httpGet:
              path: /health
              port: 8080

        # 2. Licensing Service
        - name: licensing-service
          image: licensing-api:v1.1.0
          ports:
            - containerPort: 8081
          env:
            - name: ENTITLEMENTS_URL
              value: "http://localhost:8080"
          livenessProbe:
            httpGet:
              path: /health
              port: 8081

        # 3. Telemetry Collector (Sidecar or standalone)
        - name: telemetry-collector
          image: telemetry-agent:latest
          ports:
            - containerPort: 9090
          env:
            - name: SCRAPE_INTERVAL
              value: "30s"
